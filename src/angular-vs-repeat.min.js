//
// Copyright Kamil PÄ™kala http://github.com/kamilkp
// Angular Virtual Scroll Repeat v1.1.7 2016/03/08
//
!function(a,b,c){"use strict";function d(){if("pageYOffset"in a)return{scrollTop:pageYOffset,scrollLeft:pageXOffset};var b,c,d=document,e=d.documentElement,f=d.body;return b=e.scrollLeft||f.scrollLeft||0,c=e.scrollTop||f.scrollTop||0,{scrollTop:c,scrollLeft:b}}function e(b,c){return b===a?"clientWidth"===c?a.innerWidth:a.innerHeight:b[c]}function f(b,c){return b===a?d()[c]:b[c]}function g(b,c,e){var f=b.getBoundingClientRect()[e?"left":"top"],g=c===a?0:c.getBoundingClientRect()[e?"left":"top"],h=f-g+(c===a?d():c)[e?"scrollLeft":"scrollTop"];return h}var h=document.documentElement,i=h.matches?"matches":h.matchesSelector?"matchesSelector":h.webkitMatches?"webkitMatches":h.webkitMatchesSelector?"webkitMatchesSelector":h.msMatches?"msMatches":h.msMatchesSelector?"msMatchesSelector":h.mozMatches?"mozMatches":h.mozMatchesSelector?"mozMatchesSelector":null,j=b.element.prototype.closest||function(a){for(var c=this[0].parentNode;c!==document.documentElement&&null!=c&&!c[i](a);)c=c.parentNode;return c&&c[i](a)?b.element(c):b.element()},k=b.module("vs-repeat",[]).directive("vsRepeat",["$compile","$parse",function(d,h){return{restrict:"A",scope:!0,compile:function(i,k){var l,m,n,o,p,q,r=b.isDefined(k.vsRepeatContainer)?b.element(i[0].querySelector(k.vsRepeatContainer)):i,s=r.children().eq(0),t=s[0].outerHTML,u="$vs_collection",v=!1,w={vsRepeat:"elementSize",vsOffsetBefore:"offsetBefore",vsOffsetAfter:"offsetAfter",vsScrolledToEndOffset:"scrolledToEndOffset",vsExcess:"excess"};if(s.attr("ng-repeat"))q="ng-repeat",l=s.attr("ng-repeat");else if(s.attr("data-ng-repeat"))q="data-ng-repeat",l=s.attr("data-ng-repeat");else if(s.attr("ng-repeat-start"))v=!0,q="ng-repeat-start",l=s.attr("ng-repeat-start");else{if(!s.attr("data-ng-repeat-start"))throw new Error("angular-vs-repeat: no ng-repeat directive on a child element");v=!0,q="data-ng-repeat-start",l=s.attr("data-ng-repeat-start")}if(m=/^\s*(\S+)\s+in\s+([\S\s]+?)(track\s+by\s+\S+)?$/.exec(l),n=m[1],o=m[2],p=m[3],v)for(var x=0,y=r.children().eq(0);null==y.attr("ng-repeat-end")&&null==y.attr("data-ng-repeat-end");)x++,y=r.children().eq(x),t+=y[0].outerHTML;return r.empty(),{pre:function(i,k,l){function m(){if(!F||F.length<1)i[u]=[],B=0,i.sizesCumulative=[0];else if(B=F.length,K){i.sizes=F.map(function(a){var c=i.$new(!1);b.extend(c,a),c[n]=a;var d=l.vsSize||l.vsSizeProperty?c.$eval(l.vsSize||l.vsSizeProperty):i.elementSize;return c.$destroy(),d});var a=0;i.sizesCumulative=i.sizes.map(function(b){var c=a;return a+=b,c}),i.sizesCumulative.push(a)}else r();x()}function r(){J&&i.$$postDigest(function(){if(C[0].offsetHeight||C[0].offsetWidth){for(var a=C.children(),b=0,c=!1,d=!1;b<a.length;){if(null!=a[b].attributes[q]||d){if(c||(i.elementSize=0),c=!0,a[b][O]&&(i.elementSize+=a[b][O]),!v)break;if(null!=a[b].attributes["ng-repeat-end"]||null!=a[b].attributes["data-ng-repeat-end"])break;d=!0}b++}c&&(x(),J=!1,i.$evalAsync())}else var e=i.$watch(function(){(C[0].offsetHeight||C[0].offsetWidth)&&(e(),r())})})}function s(){var a="tr"===E?"":"min-",b=G?a+"width":a+"height";return b}function x(){U=void 0,V=void 0,W=B,X=0,y(K?i.sizesCumulative[B]:i.elementSize*B),A(),i.$emit("vsRepeatReinitialized",i.startIndex,i.endIndex)}function y(a){i.totalSize=i.offsetBefore+a+i.offsetAfter}function z(){var a=e(L[0],N);a!==Y&&(x(),i.$evalAsync()),Y=a}function A(){var a=f(L[0],P),b=e(L[0],N),c=C[0]===L[0]?0:g(C[0],L[0],G),d=i.startIndex,j=i.endIndex;if(K){for(d=0;i.sizesCumulative[d]<a-i.offsetBefore-c;)d++;for(d>0&&d--,d=Math.max(Math.floor(d-i.excess/2),0),j=d;i.sizesCumulative[j]<a-i.offsetBefore-c+b;)j++;j=Math.min(Math.ceil(j+i.excess/2),B)}else d=Math.max(Math.floor((a-i.offsetBefore-c)/i.elementSize)-i.excess/2,0),j=Math.min(d+Math.ceil(b/i.elementSize)+i.excess,B);W=Math.min(d,W),X=Math.max(j,X),i.startIndex=M.latch?W:d,i.endIndex=M.latch?X:j;var k=!1;if(null==U?k=!0:null==V&&(k=!0),k||(M.hunked?Math.abs(i.startIndex-U)>=i.excess/2||0===i.startIndex&&0!==U?k=!0:(Math.abs(i.endIndex-V)>=i.excess/2||i.endIndex===B&&V!==B)&&(k=!0):k=i.startIndex!==U||i.endIndex!==V),k){if(i[u]=F.slice(i.startIndex,i.endIndex),i.$emit("vsRepeatInnerCollectionUpdated",i.startIndex,i.endIndex,U,V),l.vsScrolledToEnd){var m=F.length-(i.scrolledToEndOffset||0);(i.endIndex>=m&&V<m||F.length&&i.endIndex===F.length)&&i.$eval(l.vsScrolledToEnd)}U=i.startIndex,V=i.endIndex;var n=K?"(sizesCumulative[$index + startIndex] + offsetBefore)":"(($index + startIndex) * elementSize + offsetBefore)",o=h(n),p=o(i,{$index:0}),q=o(i,{$index:i[u].length}),r=i.totalSize;H.css(s(),p+"px"),I.css(s(),r-q+"px")}return k}var B,C=b.isDefined(l.vsRepeatContainer)?b.element(k[0].querySelector(l.vsRepeatContainer)):k,D=b.element(t),E=D[0].tagName.toLowerCase(),F=[],G="undefined"!=typeof l.vsHorizontal,H=b.element("<"+E+' class="vs-repeat-before-content"></'+E+">"),I=b.element("<"+E+' class="vs-repeat-after-content"></'+E+">"),J=!l.vsRepeat,K=!!l.vsSize||!!l.vsSizeProperty,L=l.vsScrollParent?"window"===l.vsScrollParent?b.element(a):j.call(C,l.vsScrollParent):C,M="vsOptions"in l?i.$eval(l.vsOptions):{},N=G?"clientWidth":"clientHeight",O=G?"offsetWidth":"offsetHeight",P=G?"scrollLeft":"scrollTop";if(i.totalSize=0,!("vsSize"in l)&&"vsSizeProperty"in l&&console.warn("vs-size-property attribute is deprecated. Please use vs-size attribute which also accepts angular expressions."),0===L.length)throw"Specified scroll parent selector did not match any element";i.$scrollParent=L,K&&(i.sizesCumulative=[]),i.elementSize=+l.vsRepeat||e(L[0],N)||50,i.offsetBefore=0,i.offsetAfter=0,i.excess=2,G?(H.css("height","100%"),I.css("height","100%")):(H.css("width","100%"),I.css("width","100%")),Object.keys(w).forEach(function(a){l[a]&&l.$observe(a,function(b){i[w[a]]=+b,x()})}),i.$watchCollection(o,function(a){F=a||[],m()}),D.eq(0).attr(q,n+" in "+u+(p?" "+p:"")),D.addClass("vs-repeat-repeated-element"),C.append(H),C.append(D),d(D)(i),C.append(I),i.startIndex=0,i.endIndex=0;var Q=function(){A()&&!i.$$phase&&i.$digest()},R=c.throttle(Q,100);L.on("scroll",R);var S=function(){"undefined"!=typeof l.vsAutoresize&&(J=!0,r(),i.$evalAsync()),A()&&i.$evalAsync()},T=c.debounce(S,200);b.element(a).on("resize",T),i.$on("$destroy",function(){b.element(a).off("resize",T),L.off("scroll",R)}),i.$on("vsRepeatTrigger",m),i.$on("vsRepeatResize",function(){J=!0,r()});var U,V,W,X;i.$on("vsRenderAll",function(){M.latch&&setTimeout(function(){var a=B;X=Math.max(a,X),i.endIndex=M.latch?X:a,i[u]=F.slice(i.startIndex,i.endIndex),V=i.endIndex,i.$$postDigest(function(){H.css(s(),0),I.css(s(),0)}),i.$evalAsync(function(){i.$emit("vsRenderAllDone")})})});var Y,Z=b.isDefined(l.vsCheckClientSize)&&+l.vsCheckClientSize?+l.vsCheckClientSize:0,$=c.debounce(function(){"function"==typeof a.requestAnimationFrame?a.requestAnimationFrame(z):z()},Z);b.isDefined(l.vsCheckClientSize)?i.$watch($):$.cancel()}}}}}]);"undefined"!=typeof module&&module.exports&&(module.exports=k.name)}(window,window.angular,window._);